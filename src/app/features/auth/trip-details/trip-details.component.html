<div class="signup-container">
    <div class="main-content">
        <!-- Form Section -->
        <div class="form-section">
            <div class="form-content">
                <form class="form-data" [formGroup]="tripForm" (ngSubmit)="onSubmit()">
                    <div class="back-button" (click)="goBack()">
                        <div class="back-icon">
                            <img src="assets/icons/chevron-back.svg" alt="رجوع">
                        </div>
                        <span class="back-text">العودة إلى تسجيل الدخول</span>

                    </div>

                    <!-- Header -->
                    <div class="header-section">
                        <h1 class="main-title">تفاصيل رحلتك</h1>
                        <p class="subtitle">.الرجاء تحديد تفاصيل رحلاتك اليومية من وإلى وجهتك</p>
                    </div>

                    <!-- Trip Type Selection -->
                    <div class="trip-type-section">
                        <label class="section-label">نوع الرحلة</label>
                        <div class="trip-type-selector">
                            <button
                                type="button"
                                class="trip-type-option"
                                [class.active]="tripType === 'one-way'"
                                (click)="setTripType('one-way')">
                                ذهاب فقط
                            </button>
                            <button
                                type="button"
                                class="trip-type-option"
                                [class.active]="tripType === 'round-trip'"
                                (click)="setTripType('round-trip')">
                                ذهاب وعودة
                            </button>
                        </div>
                    </div>

                    <!-- Location Fields -->
                    <div class="location-fields">
                        <div class="field-row">
                            <!-- Origin Field -->
                            <div class="form-field">
                                <div class="field-header">
                                    <span class="required-asterisk">*</span>
                                    <label class="field-label">نقطة الانطلاق (من)</label>
                                </div>
                                <div class="input-wrapper" [class.invalid]="hasFieldError('origin')">
                                    <input
                                        type="text"
                                        class="form-input"
                                        placeholder="مثال: حي النرجس، الرياض"
                                        formControlName="origin"
                                        dir="rtl">
                                    <div class="input-icon">
                                        <img src="assets/icons/location-origin.svg" alt="موقع البداية">
                                    </div>
                                </div>
                                @if (hasFieldError('origin')) {
                                <div class="error">{{ getFieldError('origin') }}</div>
                                }
                            </div>
                            <!-- Destination Field -->
                            <div class="form-field">
                                <div class="field-header">
                                    <span class="required-asterisk">*</span>
                                    <label class="field-label">الوجهة (إلى)</label>
                                </div>
                                <div class="input-wrapper" [class.invalid]="hasFieldError('destination')">
                                    <input
                                        type="text"
                                        class="form-input"
                                        placeholder="مثال: جامعة الملك سعود"
                                        formControlName="destination"
                                        dir="rtl">
                                    <div class="input-icon">
                                        <img src="assets/icons/location-pin.svg" alt="موقع">
                                    </div>
                                </div>
                                @if (hasFieldError('destination')) {
                                <div class="error">{{ getFieldError('destination') }}</div>
                                }
                            </div>


                        </div>

                        <!-- Outbound Trip Details -->
                        <!-- Fixed template section - make endDate conditional like departureTime -->
                        <div class="trip-section">
                            <h3 class="section-title">تفاصيل الاشتراك</h3>
                            <div class="field-row">
                                <!-- Start Date -->
                                <div class="form-field">
                                    <div class="field-header">
                                        <span class="required-asterisk">*</span>
                                        <label class="field-label">تاريخ بدء الرحلات</label>
                                    </div>
                                    <div class="input-wrapper" [class.invalid]="hasFieldError('startDate')">
                                        <input
                                            type="date"
                                            class="form-input"
                                            [min]="getTodayDate()"
                                            formControlName="startDate">
                                        <div class="input-icon">
                                            <img src="assets/icons/calendar.svg" alt="تاريخ">
                                        </div>
                                    </div>
                                    @if (hasFieldError('startDate')) {
                                    <div class="error">{{ getFieldError('startDate') }}</div>
                                    }
                                </div>

                                <!-- End Date - Only show for round-trip -->
                                @if (tripType === 'round-trip') {
                                <div class="form-field">
                                    <div class="field-header">
                                        <span class="required-asterisk">*</span>
                                        <label class="field-label">تاريخ انتهاء الرحلات</label>
                                    </div>
                                    <div class="input-wrapper" [class.invalid]="hasFieldError('endDate')">
                                        <input
                                            type="date"
                                            class="form-input"
                                            [min]="getMinReturnDate()"
                                            formControlName="endDate">
                                        <div class="input-icon">
                                            <img src="assets/icons/calendar.svg" alt="تاريخ">
                                        </div>
                                    </div>
                                    @if (hasFieldError('endDate')) {
                                    <div class="error">{{ getFieldError('endDate') }}</div>
                                    }
                                </div>
                                }
                            </div>
                        </div>

                        <!-- Return Trip Details -->

                        <div class="trip-section">
                            <h3 class="section-title">تفاصيل رحلة الذهاب</h3>
                            <div class="field-row">
                                <!-- Arrival Time -->
                                <div class="form-field">
                                    <div class="field-header">
                                        <span class="required-asterisk">*</span>
                                        <label class="field-label">وقت الوصول المطلوب</label>
                                    </div>
                                    <div class="custom-time-input" [class.invalid]="hasFieldError('arrivalTime')">
                                        <!-- AM/PM Selector -->
                                        <div class="time-segment">
                                            <select
                                                class="time-field ampm-field"
                                                [value]="getTimeValue('arrivalTime', 'ampm')"
                                                (change)="onTimeSegmentChange('ampm', $any($event.target).value, 'arrivalTime')">
                                                <option value="">--</option>
                                                <option value="AM">صباحاً</option>
                                                <option value="PM">مساءً</option>
                                            </select>
                                        </div>

                                        <div class="time-segment">
                                            <input
                                                type="text"
                                                class="time-field minute-field"
                                                placeholder="00"
                                                maxlength="2"
                                                pattern="[0-9]*"
                                                inputmode="numeric"
                                                (keydown)="onTimeKeyDown($event)"
                                                [value]="getTimeValue('arrivalTime', 'minute')"
                                                (input)="onTimeSegmentChange('minute', $any($event.target).value, 'arrivalTime')"
                                                dir="ltr">
                                        </div>

                                        <!-- Separator -->
                                        <div class="time-separator">:</div>
                                        <div class="time-segment">
                                            <input
                                                type="text"
                                                class="time-field hour-field"
                                                placeholder="00"
                                                maxlength="2"
                                                pattern="[0-9]*"
                                                inputmode="numeric"
                                                (keydown)="onTimeKeyDown($event)"
                                                [value]="getTimeValue('arrivalTime', 'hour')"
                                                (input)="onTimeSegmentChange('hour', $any($event.target).value, 'arrivalTime')"
                                                dir="ltr">
                                        </div>

                                        <!-- Clock Icon -->
                                        <div class="input-icon">
                                            <img src="assets/icons/clock.svg" alt="وقت">
                                        </div>
                                    </div>

                                    @if (hasFieldError('arrivalTime')) {
                                    <div class="error">{{ getFieldError('arrivalTime') }}</div>
                                    }
                                </div>

                                <!-- Fixed Custom Time Input for Departure Time (Round Trip) -->
                                @if (tripType === 'round-trip') {
                                <div class="form-field">
                                    <div class="field-header">
                                        <span class="required-asterisk">*</span>
                                        <label class="field-label">وقت المغادرة</label>
                                    </div>
                                    <div class="custom-time-input" [class.invalid]="hasFieldError('departureTime')">
                                        <!-- AM/PM Selector -->
                                        <div class="time-segment">
                                            <select
                                                class="time-field ampm-field"
                                                [value]="getTimeValue('departureTime', 'ampm')"
                                                (change)="onTimeSegmentChange('ampm', $any($event.target).value, 'departureTime')">
                                                <option value="">--</option>
                                                <option value="AM">صباحاً</option>
                                                <option value="PM">مساءً</option>
                                            </select>
                                        </div>

                                        <!-- Minute Input -->
                                        <div class="time-segment">

                                            <input
                                                type="text"
                                                class="time-field minute-field"
                                                placeholder="00"
                                                maxlength="2"
                                                pattern="[0-9]*"
                                                inputmode="numeric"
                                                (keydown)="onTimeKeyDown($event)"
                                                [value]="getTimeValue('departureTime', 'minute')"
                                                (input)="onTimeSegmentChange('minute', $any($event.target).value, 'departureTime')"
                                                dir="ltr">
                                        </div>

                                        <!-- Separator -->
                                        <div class="time-separator">:</div>

                                        <!-- Hour Input -->
                                        <div class="time-segment">

                                            <input
                                                type="text"
                                                class="time-field hour-field"
                                                placeholder="00"
                                                maxlength="2"
                                                pattern="[0-9]*"
                                                inputmode="numeric"
                                                (keydown)="onTimeKeyDown($event)"
                                                [value]="getTimeValue('departureTime', 'hour')"
                                                (input)="onTimeSegmentChange('hour', $any($event.target).value, 'departureTime')"
                                                dir="ltr">
                                        </div>

                                        <!-- Clock Icon -->
                                        <div class="input-icon">
                                            <img src="assets/icons/clock.svg" alt="وقت">
                                        </div>
                                    </div>

                                    @if (hasFieldError('departureTime')) {
                                    <div class="error">{{ getFieldError('departureTime') }}</div>
                                    }
                                </div>
                                }


                            </div>
                        </div>



                        <!-- Number of Seats -->
                        <!-- Updated seats input with Safari-compatible number validation -->
                        <!-- === HTML CHANGES === -->

                        <!-- Update the seats input section in your HTML template -->
                        <div class="trip-section">
                            <h3 class="section-title">عدد المقاعد</h3>
                            <div class="form-field">
                                <div class="input-wrapper seats-input" [class.invalid]="hasFieldError('numberOfSeats')">
                                    <input
                                        type="number"
                                        class="form-input"
                                        min="1"
                                        max="3"
                                        formControlName="numberOfSeats"
                                        (input)="onSeatsInputChange($event)"
                                        (keydown)="onSeatsKeyDown($event)"
                                        (paste)="onSeatsPaste($event)"
                                        (change)="onFormFieldChange('numberOfSeats')"
                                        inputmode="numeric"
                                        pattern="[0-9]*"
                                        placeholder="اختر عدد المقاعد (1-3)"
                                        dir="rtl">
                                    <div class="input-icon">
                                        <img src="assets/icons/seats.svg" alt="مقاعد">
                                    </div>
                                </div>
                                @if (hasFieldError('numberOfSeats')) {
                                <div class="error">{{ getFieldError('numberOfSeats') }}</div>
                                }
                                <!-- Optional: Add helper text -->
                                <div class="field-hint">الحد الأقصى 3 مقاعد لكل عميل</div>
                            </div>
                        </div>
                    </div>
                    <!-- Submit Button -->
                    <div class="submit-section">
                        @if (server500Error){
                        <span class="error">{{server500Error}}</span>
                        }
                        <button type="submit" class="submit-button" [disabled]="!isFormValid()">
                            تأكيد
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Right side - Background -->
        <div class="background-section">
            <div class="background-overlay"></div>
            <div class="background-content">
                <div class="content-top">
                    <!-- Logo -->
                    <div class="logo-container animated fadeInLeft">
                        <img src="assets/icons/muri-white.png"
                            alt="موري" class="logo">
                    </div>

                    <!-- Main Heading -->
                    <h2 class="bg-title animated fadeInRight">.رحلتك تبدأ بخطوة آمنة</h2>

                    <!-- Features List -->
                    <div class="features-list animated fadeInLeft">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <img src="assets/icons/shiled-green.svg"
                                    alt="Security">
                            </div>
                            <div class="feature-content">
                                <h3 class="feature-title">أمان تثق به</h3>
                                <p class="feature-desc">.سائقون معتمدون وخاصية "طمئن من تحب" لراحة بالك وبالهم</p>
                            </div>
                        </div>

                        <div class="feature-item">
                            <div class="feature-icon">
                                <img src="assets/icons/calenda-green.svg"
                                    alt="Schedule">
                            </div>
                            <div class="feature-content">
                                <h3 class="feature-title"> جدول يناسب احتياجك</h3>
                                <p class="feature-desc">.رحلات مجدولة تلقائيًا لتناسب مواعيك بدقة</p>
                            </div>
                        </div>

                        <div class="feature-item">
                            <div class="feature-icon">
                                <img src="assets/icons/wallet-green.svg"
                                    alt="Comfort">
                            </div>
                            <div class="feature-content">
                                <h3 class="feature-title">توفير وراحة</h3>
                                <p class="feature-desc">.مقعدك محجوز في مركبة مريحة وباشتراك يوفر عليك الكثير</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Testimonial -->
                <div class="testimonial animated fadeInRight">
                    <div class="testimonial-content">
                        <div class="quote-icon">
                            <img src="assets/icons/deouble-quote-green.svg"
                                alt="Quote">
                        </div>
                        <span class="quote-text">"
                            أفضل قرار اتخذته هذا الفصل الدراسي. تطبيق موري وفر عليّ وقت وجهد كبير، والأهم من كذا، أهلي
                            صاروا متطمنين عليّ طول الوقت
                            "</span>
                        <div class="testimonial-author">
                            <div class="author-info">
                                <div class="author-name">نورة العبدالله</div>
                                <div class="author-title">طالبة في جامعة الملك سعود</div>
                            </div>
                            <img src="assets/image/quoter-( demo).png"
                                alt="نورة العبدالله" class="author-avatar">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>